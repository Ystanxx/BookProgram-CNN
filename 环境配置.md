# 环境配置指南

> 本指南适用于Windows 10/11系统，帮助您从零开始配置项目运行环境

## 📋 目录

- [前置检查](#前置检查)
- [方式一：使用Miniconda（推荐）](#方式一使用miniconda推荐)
- [方式二：使用系统Python](#方式二使用系统python)
- [验证安装](#验证安装)
- [环境管理](#环境管理)
- [常见问题解决](#常见问题解决)

---

## 前置检查

在开始安装之前，请确认以下信息：

### 系统要求

- ✅ **操作系统**：Windows 10/11（64位）
- ✅ **磁盘空间**：至少5GB可用空间
- ✅ **内存**：建议8GB以上
- ✅ **管理员权限**：部分安装步骤可能需要

### 检查是否已安装Python

打开命令提示符（CMD）或PowerShell，输入：

```bash
python --version
```

**情况1**：显示版本号（如`Python 3.11.5`）
- 如果是3.8-3.11版本，可以直接跳到[方式二](#方式二使用系统python)
- 如果是其他版本，建议使用Miniconda创建独立环境

**情况2**：提示"不是内部或外部命令"
- 说明未安装Python，继续按本指南安装

---

## 方式一：使用Miniconda（推荐）

Miniconda是轻量级的Python环境管理工具，适合多项目开发。

### 步骤1：下载Miniconda

**官方下载地址**：
- 清华镜像（推荐，速度快）：https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/
- 官方地址：https://docs.conda.io/en/latest/miniconda.html

**选择版本**：
- 文件名示例：`Miniconda3-latest-Windows-x86_64.exe`
- 大小约90MB

### 步骤2：安装Miniconda

1. **运行安装程序**
   - 双击下载的`.exe`文件
   - 如果提示需要管理员权限，点击"是"

2. **选择安装类型**
   ```
   选项：Just Me (recommended)
   说明：仅为当前用户安装，无需管理员权限
   ```

3. **选择安装路径**
   ```
   默认路径：C:\Users\你的用户名\miniconda3
   建议：使用默认路径，避免路径中包含中文或空格
   ```

4. **高级选项（重要）**
   ```
   □ Add Miniconda3 to my PATH environment variable
     （建议不勾选，避免与其他Python冲突）
   
   ☑ Register Miniconda3 as my default Python 3.x
     （建议勾选，方便使用）
   ```

5. **完成安装**
   - 等待安装完成（约2-3分钟）
   - 点击"Finish"

### 步骤3：验证Miniconda安装

打开**Anaconda Prompt**（在开始菜单搜索）：

```bash
conda --version
```

**预期输出**：
```
conda 24.x.x
```

如果显示版本号，说明安装成功！

### 步骤4：配置国内镜像源（可选但推荐）

加速软件包下载：

```bash
# 添加清华镜像源
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --set show_channel_urls yes

# 配置pip镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### 步骤5：创建项目虚拟环境

为本项目创建独立的Python环境：

```bash
# 创建名为raman_cnn的环境，Python版本3.11
conda create -n raman_cnn python=3.11 -y
```

**过程说明**：
- 下载Python 3.11及基础包（约200MB）
- 耗时约3-5分钟（取决于网速）
- 看到"done"表示创建成功

### 步骤6：激活环境

```bash
conda activate raman_cnn
```

**激活成功标志**：
- 命令行前缀变为`(raman_cnn)`
- 示例：`(raman_cnn) C:\Users\YourName>`

**重要提示**：
- ⚠️ 每次打开新的命令行窗口都需要重新激活
- 激活后才能使用该环境安装的包

### 步骤7：进入项目目录

```bash
# 切换到项目所在目录（根据实际路径修改）
cd /d "D:\你的路径\卷积神经网络（CNN）在特征局部模式识别中的优势"
```

**快捷方式**：
1. 在文件资源管理器中打开项目文件夹
2. 按住`Shift`键，右键点击空白处
3. 选择"在此处打开PowerShell窗口"或"在此处打开命令提示符"
4. 然后执行`conda activate raman_cnn`

### 步骤8：安装项目依赖

```bash
pip install -r requirements.txt
```

**如果下载速度慢**，使用清华镜像：

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**安装过程**：
- 下载并安装PyTorch、NumPy等库（约2GB）
- 耗时约10-15分钟（取决于网速）
- 进度条显示下载进度

**可能的警告**：
```
WARNING: pip is being invoked by an old script wrapper.
```
- 这是正常的警告，不影响使用
- 可以忽略或按提示升级pip

### 步骤9：验证安装成功

测试关键库是否安装成功：

```bash
python -c "import torch; print('PyTorch版本:', torch.__version__)"
python -c "import numpy; print('NumPy版本:', numpy.__version__)"
python -c "import sklearn; print('Scikit-learn版本:', sklearn.__version__)"
```

**预期输出示例**：
```
PyTorch版本: 2.1.0+cpu
NumPy版本: 1.24.3
Scikit-learn版本: 1.3.0
```

✅ 如果都能正常显示版本号，恭喜！环境配置完成！

---

## 方式二：使用系统Python

如果您已经安装了Python 3.8-3.11，可以直接使用系统Python。

### 步骤1：检查Python版本

```bash
python --version
```

**要求**：Python 3.8、3.9、3.10或3.11

**如果版本不符**：
- 前往 https://www.python.org/downloads/ 下载合适版本
- 安装时**务必勾选** "Add Python to PATH"

### 步骤2：升级pip（推荐）

```bash
python -m pip install --upgrade pip
```

### 步骤3：创建虚拟环境（推荐）

虽然使用系统Python，但仍建议创建虚拟环境：

```bash
# 在项目目录下创建虚拟环境
python -m venv venv
```

### 步骤4：激活虚拟环境

**Windows CMD**：
```bash
venv\Scripts\activate
```

**Windows PowerShell**：
```bash
venv\Scripts\Activate.ps1
```

**如果PowerShell报错**（执行策略限制）：
```bash
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

**激活成功标志**：
- 命令行前缀显示`(venv)`

### 步骤5：安装项目依赖

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 步骤6：验证安装

```bash
python -c "import torch; print('PyTorch:', torch.__version__)"
python -c "import numpy; print('NumPy:', numpy.__version__)"
```

---

## 验证安装

完成环境配置后，运行快速测试程序：

```bash
python quick_start.py
```

**预期输出**：
```
配置加载完成，使用设备: cpu
================================================================================
拉曼谱图一维卷积神经网络分析系统 - 快速开始
================================================================================

1. 数据生成演示
   - 生成100个样本
   ...

快速开始演示完成！
```

✅ 如果程序正常运行并输出结果，说明环境配置完全成功！

---

## 环境管理

### Conda环境管理常用命令

```bash
# 查看所有环境
conda env list

# 激活环境
conda activate raman_cnn

# 退出当前环境
conda deactivate

# 删除环境
conda remove -n raman_cnn --all

# 导出环境配置
conda env export > environment.yml

# 从配置文件创建环境
conda env create -f environment.yml

# 查看环境中已安装的包
conda list

# 在环境中安装新包
conda install package_name
# 或
pip install package_name
```

### 虚拟环境（venv）管理

```bash
# 激活环境（每次使用前）
venv\Scripts\activate

# 退出环境
deactivate

# 删除环境（直接删除venv文件夹）
rmdir /s venv
```

### 更新项目依赖

如果项目依赖更新：

```bash
# 激活环境后
pip install -r requirements.txt --upgrade
```

---

## 常见问题解决

### Q1: conda命令不可用

**现象**：
```
'conda' 不是内部或外部命令
```

**解决方案**：
1. **方案A**：使用"Anaconda Prompt"而不是普通CMD
   - 在开始菜单搜索"Anaconda Prompt"
   - 这个终端已配置好conda路径

2. **方案B**：手动添加conda到PATH
   - 右键"此电脑" → "属性" → "高级系统设置"
   - "环境变量" → 编辑"Path"
   - 添加：`C:\Users\你的用户名\miniconda3\Scripts`
   - 重启CMD

### Q2: pip下载速度很慢

**解决方案**：
```bash
# 临时使用镜像源
pip install package_name -i https://pypi.tuna.tsinghua.edu.cn/simple

# 永久配置镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

**常用国内镜像源**：
- 清华：https://pypi.tuna.tsinghua.edu.cn/simple
- 阿里：https://mirrors.aliyun.com/pypi/simple/
- 中科大：https://pypi.mirrors.ustc.edu.cn/simple/
- 豆瓣：https://pypi.douban.com/simple/

### Q3: 提示"No module named 'xxx'"

**原因**：某个依赖包未安装

**解决方案**：
```bash
# 重新安装所有依赖
pip install -r requirements.txt

# 或单独安装缺失的包
pip install xxx
```

**常见缺失包处理**：
```bash
pip install torch torchvision
pip install numpy scipy
pip install scikit-learn
pip install matplotlib seaborn
pip install tqdm pandas
```

### Q4: PyTorch安装失败或版本不对

**原因**：网络问题或平台不兼容

**解决方案**：

1. **使用清华镜像安装**：
```bash
pip install torch torchvision -i https://pypi.tuna.tsinghua.edu.cn/simple
```

2. **指定CPU版本**（默认）：
```bash
pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
```

3. **离线安装**：
   - 访问 https://download.pytorch.org/whl/torch/
   - 下载对应版本的.whl文件
   - `pip install 文件名.whl`

### Q5: 激活环境后仍提示找不到Python

**解决方案**：
```bash
# 确认Python路径
where python

# 如果路径不对，重新创建环境
conda remove -n raman_cnn --all
conda create -n raman_cnn python=3.11 -y
conda activate raman_cnn
```

### Q6: PowerShell无法运行激活脚本

**现象**：
```
无法加载文件...未对文件...进行数字签名
```

**解决方案**：
```bash
# 修改执行策略
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 或使用CMD而不是PowerShell
```

### Q7: 磁盘空间不足

**检查空间占用**：
```bash
# 清理conda缓存
conda clean --all

# 清理pip缓存
pip cache purge
```

### Q8: 中文路径导致问题

**建议**：
- 项目路径避免使用中文
- 如果必须使用，确保编码正确：
```bash
# 在命令行设置编码
chcp 65001
```

### Q9: 环境变量冲突

**现象**：安装了多个Python版本，命令混乱

**解决方案**：
- 使用完整路径执行：
```bash
C:\Users\YourName\miniconda3\envs\raman_cnn\python.exe script.py
```
- 或在Anaconda Prompt中使用conda环境

### Q10: 安装包时提示权限错误

**解决方案**：
```bash
# 添加--user参数
pip install --user package_name

# 或使用管理员权限运行命令行
```

---

## 快速参考卡片

### 每次使用项目的标准流程

```bash
# 1. 打开Anaconda Prompt（或CMD/PowerShell）

# 2. 激活环境
conda activate raman_cnn

# 3. 进入项目目录
cd /d "项目路径"

# 4. 运行程序
python quick_start.py
python train.py
python predict.py
```

### 环境配置速查表

| 操作 | Conda命令 | venv命令 |
|------|-----------|----------|
| 创建环境 | `conda create -n env_name python=3.11` | `python -m venv venv` |
| 激活环境 | `conda activate env_name` | `venv\Scripts\activate` |
| 退出环境 | `conda deactivate` | `deactivate` |
| 删除环境 | `conda remove -n env_name --all` | `rmdir /s venv` |
| 查看环境 | `conda env list` | - |
| 安装包 | `pip install package` | `pip install package` |
| 查看已安装包 | `conda list` 或 `pip list` | `pip list` |

---

## 下一步

环境配置完成后，请阅读 **[使用指南.md](使用指南.md)** 了解如何使用本项目。

**推荐学习路径**：
1. ✅ 环境配置（你在这里）
2. 📖 使用指南 - 快速开始
3. 📖 使用指南 - 详细教程
4. 📖 使用指南 - 项目架构
5. 📖 使用指南 - 开发者指南

---

**如有问题，请参考**：
- 使用指南中的"常见问题"章节
- 项目README.md
- 提issue到项目仓库

**祝您配置顺利！** 🎉

